<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<title>AI for fun</title>
<link rel="stylesheet" type="text/css" href="style.css">
<script src="mcts.js" charset="utf-8"></script>
<script src="reversi.js" charset="utf-8"></script>
</head>
<body>
<h1>AI for fun!</h1>
<table id="tblBoard">
</table>
<p>
<table border="1" id="tblScore">
  <tr>
    <th style="width:50%;">Player</th>
    <th>AI</th>
  </tr>
  <tr style="text-align:center;">
    <td>0</td>
    <td>0</td>
  </tr>
</table>
</p>
<p>This game looks like reversi, but has subtle differences</p>
<script>
if (!window.console) console = {log: Math.log};
var FIRST_PLAYER = 1, SECOND_PLAYER = 2;
var who = FIRST_PLAYER;
var board = [];
function clickCell(i,j) {
  return function clickCellClosure(event) {
    var cell = tblBoard.rows[i].cells[j];
    if (board[i][j] === 0) {
      board[i][j] = who;
      reversi(i, j, who);
      who = 3 - who;
      updateBoard();
    }
  };
}

function reversiDirection(i, j, di, dj, who) {
  var opponent = 3 - who;
  var y = i, x = j;
  y += di;
  x += dj;
  while (y >= 0 && y < 8 && x >= 0 && x < 8 && board[y][x] === opponent) {
    y += di;
    x += dj;
  }
  if (y >= 0 && y < 8 && x >= 0 && x < 8 && board[y][x] === who) {
    while (y !== i || x !== j) {
      board[y][x] = who;
      y -= di;
      x -= dj;
    }
  }
}

function reversi(i, j, who) {
  reversiDirection(i, j, 1, 1, who);
  reversiDirection(i, j, 1, -1, who);
  reversiDirection(i, j, -1, 1, who);
  reversiDirection(i, j, -1, -1, who);
  reversiDirection(i, j, 1, 0, who);
  reversiDirection(i, j, -1, 0, who);
  reversiDirection(i, j, 0, 1, who);
  reversiDirection(i, j, 0, -1, who);
}

var tblBoard = document.getElementById('tblBoard');
var tblScore = document.getElementById('tblScore');
for (var i = 0; i < 8; i++) {
  var r = tblBoard.insertRow();
  for (var j = 0; j < 8; j++) {
    var c = r.insertCell();
    c.innerHTML = "<img>";
    if ((i+j)&1) c.className = "odd-cell";
    else c.className = "even-cell";
    c.onclick = clickCell(i,j);
  }
  board.push(Array(8).fill(0))
}

function updateBoard() {
  var first = 0, second = 0;
  for (var i = 0; i < 8; i++) {
    for (var j = 0; j < 8; j++) {
      var img = tblBoard.rows[i].cells[j].children[0];
      if (board[i][j] === FIRST_PLAYER) {
        img.src = "black.svg";
        first++;
      }
      else if (board[i][j] === SECOND_PLAYER) {
        img.src = "white.svg";
        second++;
      }
    }
  }
  tblScore.rows[1].cells[0].innerHTML = first;
  tblScore.rows[1].cells[1].innerHTML = second;
}
</script>
</body>
</html>
